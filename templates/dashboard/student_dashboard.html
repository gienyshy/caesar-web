{% extends "base.html" %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/dashboard.css" type="text/css" />
{% endblock %}

{% block js %}
{{ block.super }}
<script>
$(document).ready(function() {

    $('.submission-line').click(function(e) {
      var submission_id = this.id.split('-')[1];
      window.location = "/chunks/submission/all/" + submission_id;
      return false;
    });
    $('.task-line').click(function(e) {
      var chunkId = this.id.split('-')[2];
      window.location = "/chunks/view/" + chunkId;
      return false;
    });

    var toggleInstructionsText = [ 'Hide instructions', 'Show instructions' ];
    var textIndex = 0;
    $('#toggle-instructions-button').click(function() {
        $('#instructions-text').toggle(400);
        textIndex = 1 - textIndex;
        $(this).text(toggleInstructionsText[textIndex]);
    });
    
    $('#historic_content').hide();
    var toggleTaskText = [ 'hide previous semesters', 'show previous semesters' ];
    var taskIndex = 1;
    $('.history').click(function() {
        $('#historic_content').toggle(400);
        taskIndex = 1 - taskIndex;
        $(this).text(toggleTaskText[taskIndex]);
        $(".empty").remove();
    });
    
    var toggleSemesterText = [ 'hide previous semesters', 'show previous semesters' ];
    var semesterIndex = 1;
    $('#historic-submissions').hide();
    $('.history-submissions').click(function() {
        $('#historic-submissions').toggle(400);
        semesterIndex = 1 - semesterIndex;
        $(this).text(toggleTaskText[semesterIndex]);
    });

});
</script>

{% endblock %}

{% block breadcrumbs %}
  <a class="breadcrumb first-breadcrumb" href="{% url dashboard.views.dashboard %}">Dashboard</a>
  <a class="breadcrumb" href="{% url accounts.views.allusers %}">all users</a>
  <a class="breadcrumb" href="{% url accounts.views.view_profile participant%}">{{participant.username}}</a>
  <span class="breadcrumb">{{ participant.username }} Dashboard</span>
{% endblock %}

{% block secondary-toolbar %}
{% include "dashboard/dashboard_toolbar.html" %}
{% endblock %}

{% block content %}

{% if participant.profile.is_student %}
<div class="assignment-header">
    <h2 class="task-header">current assignments</h2>
</div>

<table class="current-assignment">
  {% for milestone, extension in current_milestone_data %}
  <tr class="assignment-line">
    <td class="black-text"> {{ milestone.full_name }} </td>
    <td class="grey-text"> Due on: {{ milestone.duedate }} 
        {%if extension %}
          <span class="red-text"> </br> Extended to: {{extension.new_duedate}} </span>
        {% endif %}
    </td>
    {% if milestone.max_extension > 0 %}
      <td class="=grey-text"><a href="{% url accounts.views.request_extension milestone.id %}"> request extension</a></td>
    {% endif %}
  </tr>
  {% empty %}
  {% endfor %}
</table>
{% endif %}

{% if submission_data or old_submission_data %}
<h2 class="task-header">submitted assignments</h2>
<div>
  {% for submission, reviewer_count, last_modified, user_comments, static_comments in submission_data %}
  
  <div id ="submission-{{submission.id}}" class="submission-line">
    <span class="chunk-name">
      {{ submission.milestone.full_name }}
    </span>
    <span class="task-stats">
      <span class="reviewer-count" title="Reviewers">
          {{ reviewer_count }}
      </span>
      <span class="comment-count" title="User Comments">
        {{ user_comments }}
      </span>
      <span class="robot-count" title="Automatic Comments">
        {{ static_comments }}
      </span>
    </span>
    <span class="task-snippet">
      {{ last_modified }}
    </span>
  </div>
  {% empty %}
  {% endfor %}
</div>
{% if old_submission_data %}
    <div class="history-submissions"> show previous semesters </div>
    <div id="historic-submissions" class="task-list">
      {% for submission, reviewer_count, last_modified, user_comments, static_comments in old_submission_data %}
  
      <div id ="submission-{{submission.id}}" class="submission-line">
        <span class="chunk-name">
          {{ submission.milestone.full_name }}
        </span>
        <span class="task-stats">
          <span class="reviewer-count" title="Reviewers">
              {{ reviewer_count }}
          </span>
          <span class="comment-count" title="User Comments">
            {{ user_comments }}
          </span>
          <span class="robot-count" title="Automatic Comments">
            {{ static_comments }}
          </span>
        </span>
        <span class="task-snippet">
          {{ last_modified }}
        </span>
      </div>
      {% empty %}
      {% endfor %}
    </div>
    {% endif %}
{% endif %}


<div class="span-24">
{% if new_task_count > 0 %}
<div class="success">
  You have {{ new_task_count }} new review task{{ new_task_count|pluralize }}.
</div>
{% endif %}
<h2 class="task-header">code to review</h2>
<div class="task-list">
  {% for task in active_tasks.all %}
    {% include "dashboard/task.html" %}
  {% empty %}
 No tasks left. If you haven't already, please fill out our <a href="https://spreadsheets.google.com/spreadsheet/viewform?formkey=dGNyMlRVTGNTbXFZazA5bDRPd25sZFE6MQ" target="_blank">feedback survey</a>.  {% endfor %}
</div>

<h2 class="task-header">code already reviewed</h2>
<div id="task-section">
  {% for task in completed_tasks.all %}
    {% include "dashboard/task.html" %}
  {% empty %}
  <div class="empty">
  No recent tasks found.
  </div>
  {% endfor %}
</div>
{% if old_completed_tasks.all %}
    <div class="history"> show previous semesters </div>
    <div id="historic_content">
    <div class="task-list">
      {% for task in old_completed_tasks.all %}
        {% if user.profile.is_student %}
            {% include "dashboard/non_task.html" %}
        {% else %}
            {% include "dashboard/task.html" %}
        {% endif %}
      {% empty %}
      No tasks found.
      {% endfor %}
    </div>
    </div>
{% endif %}
</div>

{% endblock %}
