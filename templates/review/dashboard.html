{% extends "base.html" %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/dashboard.css" type="text/css" />
{% endblock %}

{% block js %}
{{ block.super }}
<script>
$(document).ready(function() {

    $('.submission-line').click(function(e) {
      var submission_id = this.id.split('-')[1];
      window.location = "/chunks/submission/all/" + submission_id;
      return false;
    });
    $('.task-line').click(function(e) {
      var chunkId = this.id.split('-')[2];
      window.location = "/chunks/view/" + chunkId;
      return false;
    });

    var toggleInstructionsText = [ 'Hide instructions', 'Show instructions' ];
    var textIndex = 0;
    $('#toggle-instructions-button').click(function() {
        $('#instructions-text').toggle(400);
        textIndex = 1 - textIndex;
        $(this).text(toggleInstructionsText[textIndex]);
    });

});
</script>

{% endblock %}

{% block breadcrumbs %}
  <a class="breadcrumb first-breadcrumb" href="{% url review.views.dashboard %}">Dashboard</a>
{% endblock %}

{% block secondary-toolbar %}
<div id="secondary-toolbar-inner">
  <div id="instructions-text">
    <p>Welcome to Caesar, a tool for crowd-sourcing code review in the 
    classroom. Rather than the traditional model of code review (where reviewers
    look at a whole program or commit), the system divides a program into
    individual functions and assigns each one to different reviewers.</p>
    <p>To help us test the system, we ask that you review 3 functions (each from
    a different submitted program, but all for the same assignment), and then 
    complete a 
    <a href="https://spreadsheets.google.com/spreadsheet/viewform?formkey=dGNyMlRVTGNTbXFZazA5bDRPd25sZFE6MQ" target="_blank">short
        feedback survey</a> about the tool.</p>
    <p class="bottom">
      Please start reviewing code by clicking one of the functions below.
    </p>
  </div>
</div>
{% endblock %}

{% block content %}

{% if user.profile.is_student %}
<div class="assignment-header">
    <h2 class="task-header">current assignments</h2>
</div>

<table class="current-assignment">
  {% for submission in current_submissions %}
  <tr class="assignment-line">
    <td class="black-text"> {{ submission.assignment.name }} </td>
    <td class="grey-text"> Due on: {{ submission.assignment.duedate }} 
        {%if submission.assignment.duedate != submission.duedate %}
        <span class="red-text"> </br> Extended to: {{submission.duedate}} </span>
        {% endif %}
    </td>
    <td class="black-text"> Revision: {%if submission.revision %}{{ submission.revision }} {% else %} N/A {% endif %}</td>
    <td class="grey-text"> Modified on: {%if submission.revision_date %} {{ submission.revision_date }} {% else %} N/A {% endif %} </td>
    <td class="=submit-text"><a href="{% url chunks.views.submit_assignment submission.assignment.id %}"> update to current revision</a></td>
    <td class="=submit-text"><a href="{% url review.views.request_extension submission.assignment.id %}"> request extension</a></td>
  </tr>
  {% empty %}
  {% endfor %}
</table>


<h2 class="task-header">submitted assignments</h2>
<div class="task-list">
  {% for submission, reviewer_count, last_modified, user_comments, static_comments in submission_data %}
  
  <div id ="submission-{{submission.id}}" class="submission-line">
    <span class="chunk-name">
      {{ submission.assignment.name }}
    </span>
    <span class="task-stats">
      <span class="reviewer-count" title="Reviewers">
          {{ reviewer_count }}
      </span>
      <span class="comment-count" title="User Comments">
        {{ user_comments }}
      </span>
      <span class="robot-count" title="Automatic Comments">
        {{ static_comments }}
      </span>
    </span>
    <span class="task-snippet">
      {{ last_modified }}
    </span>
  </div>
  {% empty %}
  {% endfor %}
</div>
{% endif %}
<div class="span-24">
{% if new_task_count > 0 %}
<div class="success">
  You have {{ new_task_count }} new review task{{ new_task_count|pluralize }}.
</div>
{% endif %}
<h2 class="task-header">code to review</h2>
<div class="task-list">
  {% for task in active_tasks.all %}
    {% include "review/task.html" %}
  {% empty %}
  No functions left. If you haven't already, please fill out our <a href="https://spreadsheets.google.com/spreadsheet/viewform?formkey=dGNyMlRVTGNTbXFZazA5bDRPd25sZFE6MQ" target="_blank">feedback survey</a>.
  {% endfor %}
</div>

<h2 class="task-header">code recently reviewed</h2>
<div class="task-list">
  {% for task in completed_tasks.all %}
    {% include "review/task.html" %}
  {% empty %}
  No tasks found
  {% endfor %}
</div>


</div>
{% endblock %}
